"use strict";(self.webpackChunkcosmos_sdk_docs=self.webpackChunkcosmos_sdk_docs||[]).push([[165],{3905:(e,t,o)=>{o.d(t,{Zo:()=>c,kt:()=>u});var n=o(7294);function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){a(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function p(e,t){if(null==e)return{};var o,n,a=function(e,t){if(null==e)return{};var o,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||(a[o]=e[o]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}var l=n.createContext({}),s=function(e){var t=n.useContext(l),o=t;return e&&(o="function"==typeof e?e(t):i(i({},t),e)),o},c=function(e){var t=s(e.components);return n.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var o=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),d=s(o),u=a,h=d["".concat(l,".").concat(u)]||d[u]||m[u]||r;return o?n.createElement(h,i(i({ref:t},c),{},{components:o})):n.createElement(h,i({ref:t},c))}));function u(e,t){var o=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=o.length,i=new Array(r);i[0]=d;var p={};for(var l in t)hasOwnProperty.call(t,l)&&(p[l]=t[l]);p.originalType=e,p.mdxType="string"==typeof e?e:a,i[1]=p;for(var s=2;s<r;s++)i[s]=o[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,o)}d.displayName="MDXCreateElement"},939:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>r,metadata:()=>p,toc:()=>s});var n=o(7462),a=(o(7294),o(3905));const r={sidebar_position:1},i="Application mempool",p={unversionedId:"building-apps/app-mempool",id:"building-apps/app-mempool",title:"Application mempool",description:"This sections describes how the app side mempool can be used and replaced.",source:"@site/docs/building-apps/02-app-mempool.md",sourceDirName:"building-apps",slug:"/building-apps/app-mempool",permalink:"/main/building-apps/app-mempool",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Overview of `app_v2.go`",permalink:"/main/building-apps/app-go-v2"},next:{title:"Setting up the keyring",permalink:"/main/run-node/keyring"}},l={},s=[{value:"Prepare Proposal",id:"prepare-proposal",level:2},{value:"Process Proposal",id:"process-proposal",level:2},{value:"Mempool",id:"mempool",level:2},{value:"Configurations",id:"configurations",level:3},{value:"MaxTxs",id:"maxtxs",level:4}],c={toc:s};function m(e){let{components:t,...o}=e;return(0,a.kt)("wrapper",(0,n.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"application-mempool"},"Application mempool"),(0,a.kt)("admonition",{title:"Synopsis",type:"note"},(0,a.kt)("p",{parentName:"admonition"},"This sections describes how the app side mempool can be used and replaced. ")),(0,a.kt)("p",null,"Since ",(0,a.kt)("inlineCode",{parentName:"p"},"0.47")," the application has its own mempool to allow much more granular block building than previous versions. This change was enabled by ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/tendermint/tendermint/blob/main/spec/abci/README.md"},"ABCI 1.0"),". Notably it introduces the prepare and process proposal steps of ABCI. "),(0,a.kt)("h2",{id:"prepare-proposal"},"Prepare Proposal"),(0,a.kt)("p",null,"Prepare proposal handles construction of the block, meaning that when a proposer is preparing to propose a block it asks the application if the txs it collected from the mempool are the right ones, at which point the application will check its own mempool for txs that it would like to include. Now, reading mempool twice in the previous sentence is confusing, lets break it down. Tendermint has a mempool that handles bradcasting transactions to other nodes in the network, but it does not handle ordering of these transactions. The ordering happens at the application level in its own mempool. Allowing the application to handle ordering enables the application to define how it would like the block constructed. "),(0,a.kt)("p",null,"Currently, there is a default ",(0,a.kt)("inlineCode",{parentName:"p"},"PrepareProposal")," implementation provided by the application."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/main/baseapp/baseapp.go#L866-L904\n")),(0,a.kt)("p",null,"This default implementation can be overridden by the application developer in favor of a custom implementation:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/main/simapp/app.go#L197-L199\n")),(0,a.kt)("h2",{id:"process-proposal"},"Process Proposal"),(0,a.kt)("p",null,"Process proposal handles the validation of what is in a block, meaning that after a block has been proposed the other validators have the right to vote no or yes on a block. The validator in the default implementation of ",(0,a.kt)("inlineCode",{parentName:"p"},"PrepareProposal")," runs the transaction in a non execution fashion, it runs the antehandler and gas operations to make sure the transaction is valid. "),(0,a.kt)("p",null,"Here is the implementation of the default implementation:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/bcff22a3767b9c5dd7d1d562aece90cf72e05e85/baseapp/baseapp.go#L906-L930\n")),(0,a.kt)("p",null,"Like ",(0,a.kt)("inlineCode",{parentName:"p"},"PrepareProposal")," this implementation is the default and can be modified by the application developer. "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/main/simapp/app.go#L200-L203\n")),(0,a.kt)("h2",{id:"mempool"},"Mempool"),(0,a.kt)("p",null,"Now that we have walked through the ",(0,a.kt)("inlineCode",{parentName:"p"},"PrepareProposal")," & ",(0,a.kt)("inlineCode",{parentName:"p"},"ProcessProposal"),", we can move on to walking through the mempool. "),(0,a.kt)("p",null,"There are countless designs that an application developer can write for a mempool, the core team opted to provide a simple implementation of a nonce mempool. The nonce mempool is a mempool that keeps transactions from an sorted by nonce in order to avoid the issues with nonces. "),(0,a.kt)("p",null,"It works by storing the transation in a list sorted by the transaction nonce. When the proposer asks for transactions to be included in a block it randomly selects a sender and gets the first transaction in the list. It repeats this until the mempool is empty or the block is full. "),(0,a.kt)("h3",{id:"configurations"},"Configurations"),(0,a.kt)("h4",{id:"maxtxs"},"MaxTxs"),(0,a.kt)("p",null,"Its an integer value that sets the mempool in one of three modes, bounded, unbounded, or disabled."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"negative"),": Disabled, mempool does not insert new tx and return early."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"zero"),": Unbounded mempool has no tx limit and will never fail with ErrMempoolTxMaxCapacity."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"positive"),": Bounded, it fails with ErrMempoolTxMaxCapacity when maxTx value is the same as CountTx()")))}m.isMDXComponent=!0}}]);